var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var Urodoz;
(function (Urodoz) {
    (function (_i18n) {
        var Plugin = (function (_super) {
            __extends(Plugin, _super);
            function Plugin() {
                _super.apply(this, arguments);
            }
            Plugin.prototype.tokenSubscribers = function () {
                return [
                    new Urodoz.i18n.Subscriber.i18nSubscriber()
                ];
            };

            Plugin.prototype.componentLibraries = function () {
                var i18nLibrary = new Urodoz.i18n.Libraries.TranslationsLibrary();
                i18nLibrary.initModel();

                return {
                    "i18n": i18nLibrary
                };
            };

            Plugin.prototype.mapping = function () {
                return {};
            };
            return Plugin;
        })(Chloe.Base.AbstractBasePlugin);
        _i18n.Plugin = Plugin;
    })(Urodoz.i18n || (Urodoz.i18n = {}));
    var i18n = Urodoz.i18n;
})(Urodoz || (Urodoz = {}));
var Urodoz;
(function (Urodoz) {
    (function (i18n) {
        (function (Subscriber) {
            var i18nSubscriber = (function (_super) {
                __extends(i18nSubscriber, _super);
                function i18nSubscriber() {
                    _super.apply(this, arguments);
                }
                i18nSubscriber.prototype.update = function (data) {
                    if (_.isString(data)) {
                        if (/^urodoz\:i18n\:.*$/.test(data)) {
                            var localizedIdentifier = data.replace('urodoz:i18n:', '');

                            var seed = chloe.ID();
                            var component = chloe.create({
                                "xtype": "text",
                                "id": seed,
                                "text": chloe.get("libraries").get("i18n").currentTranslationSet.get(localizedIdentifier)
                            });

                            chloe.get("libraries").get("i18n").currentTranslationSet.on("change:" + localizedIdentifier, function (model, value, options) {
                                chloe.getCmp(seed).set("text", value);
                            });

                            return component;
                        }
                    }

                    return data;
                };
                return i18nSubscriber;
            })(Chloe.Base.Base);
            Subscriber.i18nSubscriber = i18nSubscriber;
        })(i18n.Subscriber || (i18n.Subscriber = {}));
        var Subscriber = i18n.Subscriber;
    })(Urodoz.i18n || (Urodoz.i18n = {}));
    var i18n = Urodoz.i18n;
})(Urodoz || (Urodoz = {}));
var Urodoz;
(function (Urodoz) {
    (function (i18n) {
        (function (Libraries) {
            var TranslationsCollection = (function (_super) {
                __extends(TranslationsCollection, _super);
                function TranslationsCollection() {
                    _super.apply(this, arguments);
                }
                TranslationsCollection.prototype.addTranslation = function (translationKey, translation) {
                    this.set(translationKey, translation);
                };
                return TranslationsCollection;
            })(Chloe.Base.Base);
            Libraries.TranslationsCollection = TranslationsCollection;
        })(i18n.Libraries || (i18n.Libraries = {}));
        var Libraries = i18n.Libraries;
    })(Urodoz.i18n || (Urodoz.i18n = {}));
    var i18n = Urodoz.i18n;
})(Urodoz || (Urodoz = {}));
var Urodoz;
(function (Urodoz) {
    (function (i18n) {
        (function (Libraries) {
            var TranslationsLibrary = (function () {
                function TranslationsLibrary() {
                    this.translationCollections = {};
                }
                TranslationsLibrary.prototype.initModel = function () {
                    this.currentTranslationSet = new Backbone.Model();
                };

                TranslationsLibrary.prototype.addTranslation = function (locale, translationKey, translation) {
                    if (!_.has(this.translationCollections, locale)) {
                        this.translationCollections[locale] = new Urodoz.i18n.Libraries.TranslationsCollection();
                    }
                    ;
                    this.translationCollections[locale].addTranslation(translationKey, translation);
                };

                TranslationsLibrary.prototype.setLocale = function (locale) {
                    var self = this;
                    this.currentLocale = locale;

                    var attributesToDump = this.translationCollections[locale].attributes;
                    var keys = _.keys(attributesToDump);

                    _.each(keys, function (key) {
                        self.currentTranslationSet.set(key, attributesToDump[key]);
                    });

                    var momentLibrary = moment;
                    momentLibrary.lang(locale);
                };

                TranslationsLibrary.prototype.addTranslations = function (locale, translationObject) {
                    var self = this;
                    var translationKeys = _.keys(translationObject);
                    _.each(translationKeys, function (translationKey) {
                        self.addTranslation(locale, translationKey, translationObject[translationKey]);
                    });
                };
                return TranslationsLibrary;
            })();
            Libraries.TranslationsLibrary = TranslationsLibrary;
        })(i18n.Libraries || (i18n.Libraries = {}));
        var Libraries = i18n.Libraries;
    })(Urodoz.i18n || (Urodoz.i18n = {}));
    var i18n = Urodoz.i18n;
})(Urodoz || (Urodoz = {}));
//# sourceMappingURL=chloe.i18n.min.js.map
